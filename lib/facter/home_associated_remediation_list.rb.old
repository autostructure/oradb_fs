#/tmp/puppet_remediate_db_NUM_SID_ACTION
Facter.add(:home_associated_remediation_list) do
 confine :kernel => 'Linux'
 setcode do

  rem_array = ['']
  home = ''
  sid = ''
  command = 'ls -lQ /tmp | grep -E \"puppet_remediate_db_[0-9]*_[[:alpha:]]{1}[A-Za-z0-9_\$\#]{0\,7}_\"$ | awk \'$3 == "oracle" {print $9}\' | sort'
  rem_entries = %x[#{command}]

  if !rem_entries.empty?
   count = 0
   compare = ''

   rem_entries.each_line do |li|

    holding = li[18..-1].strip
    home = holding.match('db_[0-9]*_')[0]
    sid = holding.gsub(/db_[0-9]*_/, '').gsub(/_.*/, '')
    action = holding.gsub(/.*_/, '')
    home = home.chomp('_')

    if compare == ''
     compare = home
     rem_array[count] = compare  + ':' + sid
    elsif home == compare
     rem_array[count] = rem_array[count] + ':' + sid
    else
     count = count + 1
     compare = home
     rem_array[count] = compare + ':' + sid
    end
   end
  end

  rem_array

 end
end

